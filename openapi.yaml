openapi: 3.0.3
info:
  title: Name My Server API
  description: API for generating random server names and managing name buckets
  version: 1.0.0-alpha1
servers:
- url: http://localhost:8080/api
  description: Local development server
paths:
  /v1alpha1/generate:
    post:
      summary: Generate a random server name
      description: Generates a single random server name with optional filters
      operationId: generateName
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                filters:
                  type: object
                  description: Optional filters for name generation. If not provided,
                    names are generated without constraints.
                  properties:
                    length_enabled:
                      type: boolean
                      description: Whether length filtering is enabled
                      default: false
                      example: true
                    length:
                      type: integer
                      description: Length constraint for generated names (required
                        if length_enabled is true)
                      example: 14
                    length_mode:
                      type: string
                      enum:
                      - upto
                      - exactly
                      description: Mode for length constraint
                      default: upto
                      example: upto
      responses:
        '200':
          description: Successfully generated a name
          content:
            application/json:
              schema:
                type: object
                required:
                - name
                properties:
                  name:
                    type: string
                    description: The generated server name
                    example: brave-mountain
        '400':
          description: Bad Request - Invalid filter parameters or no matches
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1alpha1/buckets:
    post:
      summary: Create a new bucket
      description: Creates a new bucket and fills it with generated names based on
        the provided filters
      operationId: createBucket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - name
              properties:
                name:
                  type: string
                  description: Name of the bucket
                  example: production-servers
                filters:
                  type: object
                  description: Optional filters for name generation. If not provided,
                    names are generated without constraints.
                  properties:
                    length_enabled:
                      type: boolean
                      description: Whether length filtering is enabled
                      default: false
                      example: true
                    length:
                      type: integer
                      description: Length constraint for generated names (required
                        if length_enabled is true)
                      example: 14
                    length_mode:
                      type: string
                      enum:
                      - upto
                      - exactly
                      description: Mode for length constraint
                      default: upto
                      example: upto
                description:
                  type: string
                  description: Description of the bucket
                  example: Server names for production environment
      responses:
        '201':
          description: Bucket successfully created
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      summary: List all buckets
      description: Returns a list of all buckets, optionally filtered to show only
        archived buckets
      operationId: listBuckets
      parameters:
      - name: archived
        in: query
        description: If present (regardless of value), returns only archived buckets
        required: false
        schema:
          type: string
      responses:
        '200':
          description: Successfully retrieved bucket list
          content:
            application/json:
              schema:
                type: object
                required:
                - buckets
                properties:
                  buckets:
                    type: array
                    items:
                      $ref: '#/components/schemas/BucketListItem'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1alpha1/buckets/{id}:
    get:
      summary: Get bucket details
      description: Returns detailed information about a specific bucket
      operationId: getBucketDetails
      parameters:
      - name: id
        in: path
        description: Bucket ID
        required: true
        schema:
          type: integer
          format: int32
      responses:
        '200':
          description: Successfully retrieved bucket details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BucketDetails'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      summary: Update bucket
      description: Updates mutable fields of a bucket. Currently only the description can be updated. Name, filters, and cursor are immutable.
      operationId: updateBucket
      parameters:
      - name: id
        in: path
        description: Bucket ID
        required: true
        schema:
          type: integer
          format: int32
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                description:
                  type: string
                  description: New description for the bucket. Use empty string to clear the description.
                  maxLength: 2048
                  example: Updated server names for production environment
      responses:
        '200':
          description: Successfully updated bucket
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BucketDetails'
        '400':
          description: Bad Request - Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '404':
          description: Not Found - Bucket does not exist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '409':
          description: Conflict - Bucket is archived and read-only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1alpha1/buckets/{id}/pop:
    post:
      summary: Pop a name from bucket
      description: Removes and returns a name from the specified bucket
      operationId: popBucketName
      parameters:
      - name: id
        in: path
        description: Bucket ID
        required: true
        schema:
          type: integer
          format: int32
      responses:
        '200':
          description: Successfully popped a name from the bucket
          content:
            application/json:
              schema:
                type: object
                required:
                - name
                properties:
                  name:
                    type: string
                    description: The popped server name
                    example: brave-mountain
        '409':
          description: Conflict - Bucket is archived and read-only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1alpha1/buckets/{id}/archive:
    post:
      summary: Archive a bucket
      description: Marks a bucket as archived. Archived buckets are read-only and will be automatically deleted after 3 days. This operation is idempotent - archiving an already-archived bucket returns success.
      operationId: archiveBucket
      parameters:
      - name: id
        in: path
        description: Bucket ID
        required: true
        schema:
          type: integer
          format: int32
      responses:
        '200':
          description: Successfully archived bucket
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BucketDetails'
        '404':
          description: Not Found - Bucket does not exist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1alpha1/buckets/{id}/recover:
    post:
      summary: Recover an archived bucket
      description: Removes the archived status from a bucket, making it active again. This operation is idempotent - recovering an already-active bucket returns success.
      operationId: recoverBucket
      parameters:
      - name: id
        in: path
        description: Bucket ID
        required: true
        schema:
          type: integer
          format: int32
      responses:
        '200':
          description: Successfully recovered bucket
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BucketDetails'
        '404':
          description: Not Found - Bucket does not exist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetail'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  schemas:
    BucketListItem:
      type: object
      required:
      - id
      - name
      - description
      - created_at
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the bucket
          example: 1
        name:
          type: string
          description: Name of the bucket
          example: production-servers
        description:
          type: string
          description: Description of the bucket
          example: Server names for production environment
        created_at:
          type: string
          format: date-time
          description: Timestamp when the bucket was created
          example: '2025-12-22T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the bucket was last updated
          example: '2025-12-22T10:30:00Z'
        archived_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the bucket was archived
          example: null
    BucketDetails:
      type: object
      required:
      - id
      - name
      - description
      - created_at
      - remaining_pairs
      - filters
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the bucket
          example: 1
        name:
          type: string
          description: Name of the bucket
          example: production-servers
        description:
          type: string
          description: Description of the bucket
          example: Server names for production environment
        created_at:
          type: string
          format: date-time
          description: Timestamp when the bucket was created
          example: '2025-12-22T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the bucket was last updated
          example: '2025-12-22T10:30:00Z'
        archived_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the bucket was archived
          example: null
        remaining_pairs:
          type: integer
          format: int64
          description: Number of names remaining in the bucket
          example: 42
        filters:
          type: object
          description: Filter configuration for this bucket
          required:
          - length_enabled
          properties:
            length_enabled:
              type: boolean
              description: Whether length filtering is enabled
              example: true
            length:
              type: integer
              nullable: true
              description: Length constraint value (null if not enabled)
              example: 14
            length_mode:
              type: string
              enum:
              - upto
              - exactly
              description: Mode for length constraint
              example: upto
    ProblemDetail:
      type: object
      description: RFC 7807 Problem Details for HTTP APIs
      required:
      - status
      - type
      - title
      properties:
        status:
          type: integer
          description: HTTP status code
          example: 599
        type:
          type: string
          description: A URI reference that identifies the problem type
          example: example_error
        title:
          type: string
          description: A short, human-readable summary of the problem
          example: Invalid input provided
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence
          example: The request contains invalid or missing required fields
    Error:
      type: object
      required:
      - title
      properties:
        title:
          type: string
          description: Error title
          example: Internal Server Error
        internal.error.type:
          type: string
          description: Internal error type (only in debug mode)
          example: '*errors.errorString'
        internal.error.message:
          type: string
          description: Internal error message (only in debug mode)
          example: database connection failed
  responses:
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
